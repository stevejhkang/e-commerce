<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Item Product</title>

    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500|Poppins:400,500,600,700|Roboto:400,500"
          rel="stylesheet"/>
    <!-- Bootstrap href="css/bootstrap.min.css"-->
    <link type="text/css" rel="stylesheet" th:href="@{/resources/css/bootstrap.min.css}"/>
    <script
            src="https://code.jquery.com/jquery-3.5.1.js"
            integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
            crossorigin="anonymous"></script>
    <!-- PLUGINS CSS STYLE -->
    <link type="text/css" th:href="@{/resources/css/vendor/toaster/toastr.min.css}" rel="stylesheet"/>
    <link type="text/css" th:href="@{/resources/css/vendor/nprogress/nprogress.css}" rel="stylesheet"/>
    <link type="text/css" th:href="@{/resources/css/vendor/flag-icons/css/flag-icon.min.css}" rel="stylesheet"/>
    <link type="text/css" th:href="@{/resources/css/vendor/jvectormap/jquery-jvectormap-2.0.3.css}" rel="stylesheet"/>
    <link type="text/css" th:href="@{/resources/css/vendor/ladda/ladda.min.css}" rel="stylesheet"/>
    <link type="text/css" th:href="@{/resources/css/vendor/select2/css/select2.min.css}" rel="stylesheet"/>
    <link type="text/css" th:href="@{/resources/css/vendor/daterangepicker/daterangepicker.css}" rel="stylesheet"/>

    <!-- SLEEK CSS -->
    <link type="text/css" th:href="@{/resources/css/sleek.css}" id="sleek-css" rel="stylesheet"/>


    <!-- FAVICON -->
    <link th:href="@{/resources/img/favicon.png}" rel="shortcut icon"/>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9] -->

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--    <script src="/assets/vendor/nprogress/nprogress.js"></script>-->

    <style>
        .accordion-header-border-bottom .card-header .btn, .accordion-header-border-bottom .card-header a{
            padding: 0;
        }


    </style>

</head>

<body>

    <div class="content-wrapper">
        <div class ="content">
            <div class="breadcrumb-wrapper">
                <h1>관리자 페이지</h1>
            </div>
            <div class="col-lg-12">
                <div class="card card-default">
                    <div class="card-header card-header-border-bottom">
                        <h2>상품 등록</h2>
                    </div>

                    <div class="card-body">

                        <form name="productadd" id="productadd" method="post" th:action="@{/item/updateItem}" th:object="${item}" enctype="multipart/form-data">

                            <input type="hidden" th:field="*{itemSn}"/>
                            <div class="form-row">
                                <div class="col-md-12 mb-3 form-group">
                                    <label class="text-dark font-weight-medium" for="validationServer01">상품명</label>
                                    <span class="mb-2 mr-2 badge badge-pill badge-primary">필수</span>
                                    <input type="text" class="form-control" id="validationServer01" name="itemName"
                                           placeholder="상품명" required=""  th:placeholder="*{itemName}" th:field="*{itemName}">

                                </div>
                                <div class="row">
                                    <div class="col-md-9 mb-3 form-group">
                                        <label class="text-dark font-weight-medium" for="validationServer02">상품 가격</label>
                                        <span class="mb-2 mr-2 badge badge-pill badge-primary">필수</span>
                                        <input type="number" class="form-control" id="validationServer02" name="price"
                                               placeholder="상품 가격" required="" th:placeholder="*{price}" th:field="*{price}">
                                    </div>
<!--                                    <div class="col-md-6 mb-3 form-group">-->
<!--                                        <label class="text-dark font-weight-medium">할인 가격</label>-->
<!--                                        <input type="text" class="form-control" name="sale_price" placeholder="할인 가격">-->
<!--                                    </div>-->
                                </div>
                                <div class="col-md-12">
                                    <label class="text-dark font-weight-medium"></label>
                                    <div class="form-group row">
                                        <div class="col-6 col-md-3 text-left" style="max-width: 200px">
                                            <label>배송비 설정</label>
                                        </div>
                                        <div class="col-12 col-md-9 row">
                                            <label class="control outlined control-radio radio-primary"
                                                   style="margin-left: 20px;">무료배송
                                                <input type="radio" name="deliveryOption" id="deliveryOption1" value="ShippingCostInclude"
                                                       th:field="*{deliveryOption}" >
                                                <div class="control-indicator"></div>
                                            </label>
                                            <label class="control outlined control-radio radio-primary"
                                                   style="margin-left: 20px;">유료배송
                                                <input type="radio" name="deliveryOption" value="ShippingCostNotInclude"
                                                       th:field="*{deliveryOption}" th:value="*{deliveryOption}">
                                                <div class="control-indicator"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mb-3 form-group">
                                    <label for="exampleFormControlTextarea1">상품 설명</label>
                                    <textarea class="form-control" id="exampleFormControlTextarea1" name="description"
                                              rows="3" th:placeholder="*{description}" th:field="*{description}"></textarea>

                                </div>
                                <div class="col-md-12 mb-3 form-group">
                                    <label for="exampleFormControlTextarea1">제작자</label>
                                    <textarea class="form-control" id="exampleFormControlTextarea12" name="description"
                                              rows="3" th:placeholder="*{manufacturer}" th:field="*{manufacturer}"></textarea>
                                <div class="col-md-12">

                                    <label class="text-dark font-weight-medium"></label>
                                    <div class="form-group row">
                                        <div class="col-6 col-md-3 text-left" style="max-width: 200px">
                                            <label>상품 진열여부</label>
                                        </div>
                                        <div class="col-12 col-md-9 row">
                                            <label class="control outlined control-radio radio-primary"
                                                   style="margin-left: 20px;">진열안함
                                                <input type="radio" name="displayOption" value="NONE" th:value="*{displayOption}" th:field="*{displayOption}"
                                                       checked="checked">
                                                <div class="control-indicator"></div>
                                            </label>
                                            <label class="control outlined control-radio radio-primary"
                                                   style="margin-left: 20px;">진열함
                                                <input type="radio" name="displayOption" value="DISPLAY"  th:field="*{displayOption}">
                                                <div class="control-indicator"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                            </div>

<!--                            <div class="card-header card-header-border-bottom"></div>-->
<!--                            <div class="card-header card-header-border-bottom" style="margin-bottom: 30px;">-->
<!--                                <h2>카테고리</h2>-->
<!--                            </div>-->
<!--                            <div class="row col-md-12">-->
<!--                                <div class="form-group col-md-6">-->
<!--                                    <label>상위 카테고리</label>-->
<!--                                    <select id="parentSelect" name="category_no" class="form-control">-->
<!--                                        <option>없음</option>-->

<!--                                        <option value={{category.category_no}}>-->

<!--                                        </option>-->

<!--                                    </select>-->
<!--                                </div>-->
<!--                                <div class="form-group col-md-6">-->
<!--                                    <label>하위 카테고리</label>-->
<!--                                    <select name="category_no" class="form-control" id="lowCategory" disabled>-->
<!--                                        <option>없음</option>-->
<!--                                    </select>-->
<!--                                </div>-->


<!--                            </div>-->

                            <div class="card-header card-header-border-bottom"></div>
                            <div class="card-header card-header-border-bottom">
                                <h2>재고 / 옵션</h2>
                            </div>

                            <div class="col-md-12">
                                <div class="form-row">
                                    <label class="text-dark font-weight-medium"></label>
                                    <div class="form-group row">
                                        <div class="col-6 col-md-3 text-left" style="max-width: 200px">
                                            <label>재고 사용여부</label>
                                        </div>
                                        <div class="col-12 col-md-9 row">
                                            <label class="control outlined control-radio radio-primary"
                                                   style="margin-left: 20px;">사용안함
                                                <input type="radio" name="stock_use" value="0" checked>
                                                <div class="control-indicator"></div>
                                            </label>
                                            <label class="control outlined control-radio radio-primary"
                                                   style="margin-left: 20px;">사용함
                                                <input type="radio" name="stock_use" value="1">
                                                <div class="control-indicator"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div id="stockform1" >
                                    <div class="col-md-12 mb-3 form-group">
                                        <label class="text-dark font-weight-medium">재고개수</label>
                                        <input type="number" class="form-control" name="stock" th:placeholder="*{stock}" th:field="*{stock}">
                                    </div>
                                </div>
                            </div>


<!--                                <div class="col-md-12">-->
<!--                                    <label class="text-dark font-weight-medium"></label>-->
<!--                                    <div class="form-group row">-->
<!--                                        <div class="col-6 col-md-3 text-left" style="max-width: 200px">-->
<!--                                            <label>옵션 사용여부</label>-->
<!--                                        </div>-->
<!--                                        <div class="col-12 col-md-9 row">-->
<!--                                            <label class="control outlined control-radio radio-primary"-->
<!--                                                   style="margin-left: 20px;">사용안함-->
<!--                                                <input type="radio" name="option_use" value="0" checked="checked">-->
<!--                                                <div class="control-indicator"></div>-->
<!--                                            </label>-->
<!--                                            <label class="control outlined control-radio radio-primary"-->
<!--                                                   style="margin-left: 20px;">사용함-->
<!--                                                <input type="radio" name="option_use" value="1">-->
<!--                                                <div class="control-indicator"></div>-->
<!--                                            </label>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->


<!--                                <div class="row col-md-12" id="optionform1" style="display:none;">-->
<!--                                    <div class="row col-md-12">-->
<!--                                        <div class="col-md-3 form-group" style="margin-bottom: 0;">-->
<!--                                            <label class="text-dark font-weight-medium">[옵션명]</label>-->
<!--                                        </div>-->

<!--                                        <div class="col-md-9 form-group" style="margin-bottom: 0;">-->
<!--                                            <label class="text-dark font-weight-medium">[세부옵션명-쉼표로 구분해주세요(ex)-->
<!--                                                black,white,red)]</label>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div id="optionform2" class="row col-md-12">-->
<!--                                        <div id="optionform3" class="row col-md-12">-->
<!--                                            <div class="col-md-3 mb-3 form-group">-->

<!--                                                <input type="text" class="form-control option_name" id="option_name"-->
<!--                                                       name="optionList[0][name]"-->
<!--                                                       placeholder="옵션명">-->
<!--                                            </div>-->

<!--                                            <div class="col-md-9 mb-3 form-group">-->
<!--                                                <input type="text" class="form-control detail_name" id="detail_name"-->
<!--                                                       name="optionList[0][optionDetailList]"-->
<!--                                                       placeholder="세부옵션명">-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->

<!--                                    <div class="col-md-12 mb-3 form-group">-->
<!--                                        <button class="btn btn-sm btn-primary" id="optionAddBtn"-->
<!--                                                style="margin-top: 10px;">-->
<!--                                            옵션추가-->
<!--                                        </button>-->
<!--                                        <button class="btn btn-sm btn-danger" id="optionDelBtn"-->
<!--                                                style="margin-top: 10px;">-->
<!--                                            옵션삭제-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                    <div class="col-md-12 mb-3 form-group">-->
<!--                                        <button class="btn btn-sm btn-outline-success" id="optionCombineBtn"-->
<!--                                                style="margin-top: 10px;">-->
<!--                                            옵션품목 만들기-->
<!--                                        </button>-->

<!--                                        <button class="btn btn-sm btn-outline-info" id="optionResetBtn"-->
<!--                                                style="margin-top: 10px;">-->
<!--                                            초기화-->
<!--                                        </button>-->
<!--                                    </div>-->


<!--                                </div>-->


<!--                                <div class="col-md-12 mb-3 form-group" style="display: none;" id="optionlist">-->
<!--                                    <label class="text-dark font-weight-medium">옵션 목록</label>-->
<!--                                    <div class="card-body">-->
<!--                                        <table class="table table-striped">-->
<!--                                            <thead>-->
<!--                                            <tr>-->
<!--                                                <th scope="col">옵션코드</th>-->
<!--                                                <th scope="col">추가가격</th>-->
<!--                                                <th scope="col">재고여부</th>-->
<!--                                                <th scope="col">재고수량</th>-->
<!--                                                <th scope="col">삭제</th>-->
<!--                                            </tr>-->
<!--                                            </thead>-->
<!--                                            <tbody id="optionCombiList">-->


<!--                                            </tbody>-->
<!--                                        </table>-->
<!--                                    </div>-->
<!--                                </div>-->

                            <div class="card-header card-header-border-bottom"></div>
                            <div class="card-header card-header-border-bottom">
                                <h2>상품이미지 등록</h2>
                            </div>

                            <div class="form-row">
                                <div class="col-md-12">
                                    <label class="text-dark font-weight-medium"></label>
                                    <div class="form-group row">
                                        <div class="col-6 col-md-3 text-left" style="max-width: 200px">
                                            <label>대표이미지</label>
                                        </div>
                                        <div class="col-12 col-md-9 row">
                                            <div class="form-group" style="margin-left: 20px;">
                                                <input type="file" name="mainImg" class="form-control-file" id="mainImg" th:text="*{imgSrc}" th:value="*{imgSrc}" >

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <br/>
                            <button class="btn btn-primary col-md-12" type="submit" id="productaddBtn">상품 수정</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>


    <div class="card-body" style="display: none;">
        <table class="table table-striped">
            <thead>
            <tr>
                <th scope="col">옵션코드</th>
                <th scope="col">추가가격</th>
                <th scope="col">재고여부</th>
                <th scope="col">재고수량</th>
                <th scope="col">삭제</th>
            </tr>
            </thead>
            <tbody>
            <tr id="optionlistform" name="optionInfo">
                <td scope="row"><input type="text" class="form-control" id="optioncode" readonly /></td>
                <td><input type="text" class="form-control" id="add_price"></td>
                <td><select id="stock_use2" style="margin-top: 10px;">
                    <option value="0">NO</option>
                    <option value="1">YES</option>
                </select></td>
                <td><input type="text" class="form-control" id="stock_num2" disabled></td>
                <td>
                    <button class="btn btn-sm btn-danger" id="optionCombiDelBtn" type="submit">X</button>
                </td>
            </tr>

            </tbody>
        </table>
    </div>

    </div>

    <script th:src="@{/resources/vendor/jquery/jquery.serializeObject.min.js}"></script>

    <script>
        $(document).ready(function(){
            var productadd = $("#productadd");
            var categoryadd = $("#categoryadd");
            var optionlistform = $("#optionlistform");
            var addimgform = $("#addimgform");

            var optionUse = $("input:radio[name=option_use]");
            var stockUse = $("input:radio[name=stock_use]");

            var optionform2 = $("#optionform2");
            var optionform3 = $("#optionform3");
            var optionform2Clone = $("#optionform2").clone();

            //옵션 및 재고
            optionUse.change(function(e){
                e.preventDefault();

                if($(this).val()==0){
                    $("#optionform1").attr("style","display:none;");
                    $("#optionlist").attr("style","display:none;");
                    $("#option_name").val("");
                    $("#detail_name").val("");
                } else {
                    $("input:radio[name=stock_use][value='0']").prop('checked', true);
                    $("#stockform2").html("");
                    $("#optionform1").attr("style","");
                    $("#optionlist").attr("style","");
                }
            });

            stockUse.change(function(e){
                e.preventDefault();

                if($(this).val()==0){
                    $("#stockform2").html("");
                } else {
                    // $("input:radio[name=option_use][value='0']").prop('checked', true);
                    // $("#optionform1").attr("style","display:none;");
                    // $("#option_name").val("");
                    // $("#detail_name").val("");
                    // $("#optionlist").attr("style","display:none;");
                    $("#stockform2").html($("#stockform1").html());
                    // $("#optionform2").html(optionform2Clone)
                }

            });

            var optionnum = 1;
            var optionid = 'option';

            $("#optionAddBtn").click(function(e){
                e.preventDefault();
                var clone = optionform3.clone();
                var tmp = optionid + optionnum;

                clone.find("#option_name").attr("name","optionList[" + optionnum + "][name]");
                clone.find("#detail_name").attr("name","optionList[" + optionnum + "][optionDetailList]");

                optionnum++;

                clone.attr('id', tmp);
                optionform2.append(clone);
            });

            $("#optionDelBtn").click(function(e){
                e.preventDefault();

                optionnum--;
                var tmp = optionid + optionnum;

                $("#" + tmp).remove();
            });

            var optionlistform = $("#optionlistform");
            var optioncode = $("#optioncode");
            var add_price = $("#add_price");
            var stock_use2 = $("#stock_use2");
            var stock_num2 = $("#stock_num2");
            var optionCombiList = $("#optionCombiList");

            $("#optionCombineBtn").click(function(e){
                e.preventDefault();

                var tmpReturn1 = 0;
                var tmpReturn2 = 0;

                $(".option_name").each(function(index, item){
                    if (item.value==''){
                        tmpReturn1 = 1;
                    }
                });

                $(".detail_name").each(function(index, item){
                    if (item.value==''){
                        tmpReturn2 = 1;
                    }
                });

                if(tmpReturn1 == 1){
                    alert("옵션명을 입력해주세요");
                    return;
                }

                if(tmpReturn2 == 1){
                    alert("세부옵션명을 입력해주세요");
                    return;
                }

                optionCombiList.html("");
                $(".detail_name").attr("readonly","true");
                $(".option_name").attr("readonly","true");
                $("#optionAddBtn").attr("disabled","disabled");
                $("#optionDelBtn").attr("disabled","disabled");

                var detail_name = $(".detail_name")

                var combine_list = [];
                var combine_atom_list = [];

                detail_name.each(function(index, item){
                    combine_atom_list.push(item.value.split(',').map(item => item.trim()));
                });
                combine_list = combination(combine_atom_list);

                combine_list.forEach(function(element, index){
                    optioncode.val(element);
                    optioncode.attr('name','productDetailList[' + index + '][option_code]');
                    add_price.attr('name','productDetailList[' + index + '][add_price]');
                    stock_use2.attr('name','productDetailList[' + index + '][stock_use2]');
                    stock_num2.attr('name','productDetailList[' + index + '][stock_num2]');

                    var clone = optionlistform.clone();

                    clone.find('#optionCombiDelBtn').click(function(e){
                        e.preventDefault();
                        $(this).parents('tr').remove();
                    });

                    clone.find("#stock_use2").change(function(e){
                        e.preventDefault();
                        if($(this).val()=='1'){
                            clone.find("#stock_num2").removeAttr("disabled");
                        } else {
                            clone.find("#stock_num2").val("");
                            clone.find("#stock_num2").attr("disabled","disabled");
                        }
                    });

                    optionCombiList.append(clone);
                });

            });

            //조합 알고리즘
            function combination(arr) {
                if (arr.length == 1) {
                    return arr[0];
                } else {
                    var result = [];
                    var calculate = combination(arr.slice(1));

                    for (var i = 0; i < calculate.length; i++) {
                        for (var j = 0; j < arr[0].length; j++) {
                            result.push(arr[0][j] + "/" + calculate[i]);
                        }
                    }
                    return result;
                }
            }

            $("#optionResetBtn").click(function(e){
                e.preventDefault();

                optionCombiList.html("");
                $(".detail_name").removeAttr("readonly");
                $(".option_name").removeAttr("readonly");
                $("#optionAddBtn").removeAttr("disabled");
                $("#optionDelBtn").removeAttr("disabled");
            });


            // $("#productaddBtn").click(function(e){
            //     e.preventDefault();
            //
            //     var test = JSON.stringify(productadd.serializeObject());
            //
            //     $("#test").val(test);
            //
            //     productadd.attr("action","/manager/product").attr("method","post").submit();
            //
            // });//end productaddBtn

            //이미지
            var inputnum = 1;
            var inputid = 'addImg'
            $("#addImgPlusBtn").click(function(e){
                e.preventDefault();
                var tmp = inputid + inputnum
                inputnum++;
                addimgform.append("<input type='file' name='addImg' id=" + tmp + " class='form-control-file'>");
            });

            $("#addImgMinusBtn").click(function(e){
                e.preventDefault();
                inputnum--;
                var tmp = inputid + inputnum
                $("#" + tmp).remove();

            });

            //카테고리
            $("#parentSelect").change(function(e){
                e.preventDefault();

                var lowCategory = $("#lowCategory");
                var categoryNo = $(this).val();

                if (categoryNo == '없음'){
                    lowCategory.attr("disabled","disabled");
                    return;
                }

                lowCategory.html("<option>없음</option>");

                $.ajax({
                    url: '/manager/lowlist',
                    type : 'GET',
                    data : {'parent': categoryNo },
                    success : function(result){
                        lowCategory.removeAttr("disabled");

                        result.data.forEach(function (item, index) {
                            $(lowCategory).append('<option value='+ item.category_no +'>'+ item.category_name +'</option>');
                        });

                    },
                    fail: function(e){
                        console.log("fail categoryListBtn");
                    }

                });// end ajax
            });

            $(".categoryListBtn").click(function(e){
                e.preventDefault();
                var no = $(this).data('no');
                var categoryNoId = '#category' + $(this).data('no');

                $.ajax({
                    url: '/manager/lowlist',
                    type : 'GET',
                    data : {'parent': no },
                    success : function(result){
                        $(categoryNoId).html("");
                        result.data.forEach(function (item, index) {
                            $(categoryNoId).append('<li style="padding-left: 20px; margin-bottom: 10px;">' + item.category_name + '</li>');
                        });

                    },
                    fail: function(e){
                        console.log("fail categoryListBtn");
                    }

                });// end ajax
            });//end categoryListBtn

            $("#categoryadd_btn").click(function(e){
                e.preventDefault();

                categoryadd.attr("action","/manager/categoryadd").attr("method","post").submit();
            });
        });


    </script>
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCn8TFXGg17HAUcNpkwtxxyT9Io9B_NcM"></script>
    <script th:src="@{/resources/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/resources/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/resources/vendor/toaster/toastr.min.js}"></script>
    <script th:src="@{/resources/vendor/slimscrollbar/jquery.slimscroll.min.js}"></script>
    <script th:src="@{/resources/vendor/charts/Chart.min.js}"></script>
    <script th:src="@{/resources/vendor/ladda/spin.min.js}"></script>
    <script th:src="@{/resources/vendor/ladda/ladda.min.js}"></script>
    <script th:src="@{/resources/vendor/jquery-mask-input/jquery.mask.min.js}"></script>
    <script th:src="@{/resources/vendor/select2/js/select2.min.js}"></script>
    <script th:src="@{/resources/vendor/jvectormap/jquery-jvectormap-2.0.3.min.js}"></script>
    <script th:src="@{/resources/vendor/jvectormap/jquery-jvectormap-world-mill.js}"></script>
    <script th:src="@{/resources/vendor/daterangepicker/moment.min.js}"></script>
    <script th:src="@{/resources/vendor/daterangepicker/daterangepicker.js}"></script>
    <script th:src="@{/resources/vendor/jekyll-search.min.js}"></script>
    <script th:src="@{/resources/js/sleek.js}"></script>
    <script th:src="@{/resources/js/chart.js}"></script>
    <script th:src="@{/resources/js/date-range.js}"></script>
    <script th:src="@{/resources/js/map.js}"></script>
    <script th:src="@{/resources/js/custom.js}"></script>
</body>
</html>